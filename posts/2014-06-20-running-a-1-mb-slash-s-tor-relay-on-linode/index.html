<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running a 1 MB/s Tor relay on Linode</title>
    <meta name="description" content="Evan Savage&#39;s personal blog about software, life, travel, and other sundry things.">
    <link href='http://fonts.googleapis.com/css?family=PT%20Serif:400,400italic,500,500italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Evan Savage">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Evan Savage">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
      };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Evan Savage</a></h1>

      <ul class="nav">
          <li class="nav-item"><a href="/">Home</a></li>
          <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="https://savageevan.com">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>Running a 1 MB/s Tor relay on Linode</h1>

<p><a href="https://savageinter.net/">Savage Internet</a> is proud to announce that we're now running a 1 MB/s <a href="https://www.torproject.org/">Tor</a> exit relay.  How much is this costing us?  $10/month, thanks to <a href="https://www.linode.com/">Linode's</a> excellent data transfer caps.  In this post, we'll explain how we set that up.</p>
<p>If you're not sure what Tor is, <a href="https://www.eff.org/torchallenge/what-is-tor.html">read this article</a>.</p>
<!-- more -->
<h2 id="our-node">Our Node <a class="direct-link" href="#our-node">#</a></h2>
<p>is listed <a href="https://globe.torproject.org/#/relay/D85D427500E47F6D1408C883FAB56AF4ED55F3EA">on Globe</a>.  As of time of writing, we're still <a href="https://blog.torproject.org/blog/lifecycle-of-a-new-relay">ramping up</a>, so our advertised bandwidth will be lower than 1 MB/s for a few days.</p>
<h2 id="setting-up-a-tor-relay-on-linode">Setting up a Tor Relay on Linode <a class="direct-link" href="#setting-up-a-tor-relay-on-linode">#</a></h2>
<h3 id="step-1%3A-set-up-your-linode-instance">Step 1: Set up your Linode instance <a class="direct-link" href="#step-1%3A-set-up-your-linode-instance">#</a></h3>
<p>Go to <a href="https://www.linode.com/">linode.com</a>, sign up, and add a Linode 1GB instance to your account.  You can follow Linode's <a href="https://library.linode.com/getting-started">Getting Started instructions</a>.  We're using Ubuntu as the distro, mainly because we're familiar with it and we wanted to get this up and running as quickly as possible!</p>
<h3 id="step-2%3A-install-tor">Step 2: Install Tor <a class="direct-link" href="#step-2%3A-install-tor">#</a></h3>
<p>There are some good instructions <a href="https://www.darkcoding.net/society/running-a-tor-relay-node-server-on-ubuntu/">here</a>, but they boil down to:</p>
<pre class="language-bash"><code class="language-bash">$ gpg --keyserver keys.gnupg.net --recv 886DDD89<br>$ gpg --export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -<br>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update<br>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> tor tor-arm</code></pre>
<p>Once Tor is installed, you need to configure it.</p>
<h3 id="step-3%3A-basic-tor-configuration">Step 3: Basic Tor Configuration <a class="direct-link" href="#step-3%3A-basic-tor-configuration">#</a></h3>
<p>We'll get to exit policies in a bit, but:</p>
<ul>
<li>set <code>ORPort</code> (or just uncomment it);</li>
<li>give yourself a <code>Nickname</code>, and set <code>ContactInfo</code>;</li>
<li>set <code>RelayBandwidthRate</code>, <code>RelayBandwidthBurst</code> (in our case, 1 MB/s).</li>
</ul>
<h3 id="step-4%3A-exit-policy-configuration">Step 4: Exit Policy Configuration <a class="direct-link" href="#step-4%3A-exit-policy-configuration">#</a></h3>
<p>The Tor Project recommends <a href="https://trac.torproject.org/projects/tor/wiki/doc/ReducedExitPolicy">this exit policy</a>, which allows roughly 65 ports.</p>
<h3 id="step-5%3A-block-bittorrent-using-iptables">Step 5: Block BitTorrent using iptables <a class="direct-link" href="#step-5%3A-block-bittorrent-using-iptables">#</a></h3>
<p>We went one step further and blocked common markers of BitTorrent traffic, using <a href="https://docs.google.com/document/d/1gaoln96He6yVFcAHoZGPdnDioMrqbABqw2s6nx2wdiI/edit">this set of iptables rules</a>.</p>
<h3 id="step-6%3A-run!">Step 6: Run! <a class="direct-link" href="#step-6%3A-run!">#</a></h3>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">service</span> tor start<br>$ arm                      <span class="token comment"># to see awesome graphs</span></code></pre>
<h2 id="appendix">Appendix <a class="direct-link" href="#appendix">#</a></h2>
<h3 id="what-is-tor%3F">What is Tor? <a class="direct-link" href="#what-is-tor%3F">#</a></h3>
<p><a href="https://www.eff.org/torchallenge/what-is-tor.html">EFF's Tor Challenge site</a> explains that far better than we could:</p>
<blockquote>
Tor is a service that helps you to protect your anonymity while using the Internet.
</blockquote>
<h3 id="why-linode%3F">Why Linode? <a class="direct-link" href="#why-linode%3F">#</a></h3>
<p>We compared several <a href="https://en.wikipedia.org/wiki/Virtual_private_server">virtual private server</a> providers.  <a href="https://www.linode.com/pricing">Linode</a> offers relatively high bandwidth caps: their $10/month plan, for instance, gives you 2TB/month outgoing with unlimited incoming, which is enough to sustain 700 KB/s <em>24/7</em>.  <a href="https://aws.amazon.com/ec2/">Amazon EC2</a> doesn't even compare: bandwidth charges alone for that much traffic would be about $200/month.</p>
<p><a href="https://www.noisebridge.net/">Noisebridge</a> runs <a href="https://globe.torproject.org/#/search/query=noiseexit">four Tor exit relays</a> using QuadraNet dedicated servers. Dedicated servers are more attractive once you ramp up capacity.  With QuadraNet, for instance, $700/month gets you 1Gbps unmetered, or 125 MB/s - Linode 64GB instances are comparable in cost, but those only get you 20TB/month, or 7MB/s. Since our goals are a relatively modest 1 MB/s, this would be overkill; for the same reason, we didn't look into colocation either.</p>
<h3 id="why-block-bittorrent%3F-i-thought-this-was-about-freedom!">Why block BitTorrent?  I thought this was about freedom! <a class="direct-link" href="#why-block-bittorrent%3F-i-thought-this-was-about-freedom!">#</a></h3>
<p>From Linode's Terms of Service:</p>
<blockquote cite="https://www.linode.com/tos">
  <p>
Linode does not prohibit the use of distributed, peer to peer network services such as Tor, nor does Linode routinely monitor the network communications of customer Linodes as a normal business practice. However, customers are responsible for the contents of network traffic exiting their Linode. Any usage that prompts the receipt of abuse complaints pertaining to violation of United States and/or international copyright law must be promptly discontinued to avoid service cancellation for violation of these terms.
</p>
  <footer>&ndash; Linode, <cite><a href="https://www.linode.com/tos">Linode Terms of Service</a></footer>
</blockquote>
<p>In practical terms: if you run an exit relay, Linode <em>will</em> receive DMCA takedown notices for your IP address.  They <em>will</em> pass those on to you, making them your responsibility.</p>
<p>To mitigate this risk, we block BitTorrent.  Otherwise we'll eventually have to</p>
<ul>
<li>take down the node; or</li>
<li><code>ExitPolicy reject *:*</code>; or</li>
<li>move elsewhere.</li>
</ul>
<p>An offline node is of use to no one.  A middle relay is less useful, since overall Tor network performance relies upon having exit nodes.  Moving elsewhere is doable, but it would definitely be less cost-effective (at least at our current scale - see below).</p>
<p>Another option is to donate to other relay operators.  Donations are more cost-effective in increasing Tor network bandwidth, but this comes <a href="https://blog.torproject.org/blog/turning-funding-more-exit-relays">at the expense of network diversity</a>.  (If you don't see why this is a problem, consider what happens when a malicious actor - NSA/GCHQ/etc., for instance - operates some proportion of Tor relays.)</p>
<p>Even if Linode handled DMCA complaints differently, a relay that's swamped with high-bandwidth, high-connection-count traffic from BitTorrent is of use to far fewer people than one that isn't.  We'd rather support people who <em>need</em> Tor than some dude who just can't find that awesome movie on Netflix.</p>
<p>If that's not enough for you, the Tor Project itself notes that <a href="https://blog.torproject.org/blog/bittorrent-over-tor-isnt-good-idea">BitTorrent over Tor isn't a good idea</a>, as it leaks identifying information and generally hurts network performance.</p>
<p>So: we have nothing against BitTorrent, and we do wish the DMCA would burn and die, but we will make every effort possible to prevent BitTorrent traffic from running through our relay.</p>
<h3 id="last-words">Last Words <a class="direct-link" href="#last-words">#</a></h3>
<p>This is easy to do and relatively inexpensive, and if you run a 1 MB/s relay you <a href="https://www.eff.org/torchallenge/#getstarted">might get a T-shirt from the EFF</a>.</p>


<hr>
<ul><li>Previous: <a href="/posts/2013-10-09-a-tale-of-two-trips/">A Tale of Two Trips</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /posts/2014-06-20-running-a-1-mb-slash-s-tor-relay-on-linode/ -->
  </body>
</html>
